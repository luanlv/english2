!(function t(e,a,i){function n(r,o){if(!a[r]){if(!e[r]){var d="function"==typeof require&&require;if(!o&&d)return d(r,!0);if(s)return s(r,!0);throw new Error("Cannot find module '"+r+"'")}var c=a[r]={exports:{}};e[r][0].call(c.exports,(function(t){var a=e[r][1][t];return n(a?a:t)}),c,c.exports,t,e,a,i)}return a[r].exports}for(var s="function"==typeof require&&require,r=0;r<i.length;r++)n(i[r]);return n})({1:[function(t,e,a){var i=t("../ws/_wsCtrl.js"),n=/\b(https?|ftp|file):\/\/[\-A-Za-z0-9+&@#\/%?=~_|!:,.;]*[\-A-Za-z0-9+&@#\/%=~_|‌​]/gi,s=s||{};s.rd=function(t){},s.post=function(t){return t.replace(n,(function(t){var e;return e=/[a-z]+:\/\//.test(t)?t:"http://"+t,t=t.replace(/^https?:\/\//,""),t.indexOf(document.domain)>=0||t.indexOf("localhost")>=0?"<a  class='route' href='"+e.replace(/^.*\/\/[^\/]+/,"")+"' >"+t+"</a>":"<a href='"+e+"' target='_blank'>"+e+"</a>"})).replace(/\n/g,"<br/>")},s.requestWithFeedback=function(t){var e=m.prop(),a=m.prop(!1),i=function(){a(!0)};return t.background=!0,t.config=function(t){t.timeout=4e3,t.ontimeout=function(){i(),rd.qa((function(){console.log("json error"),m.redraw()}))}},{request:m.request(t).then(e).then((function(){i(),rd.qa((function(){console.log("json ok"),m.redraw()}))})),data:e,ready:a}},s.requestWithFeedback2=function(t,e,a,i){var n=m.prop(),s=m.prop(!1),r=function(){s(!0)};return t.background=!0,t.config=function(t){t.timeout=4e3,t.ontimeout=function(){r(),m.redraw()}},{request:m.request(t).then(n).then((function(t){void 0!==e&&e(t),void 0!==a&&a(),r(),rd.all((function(){m.redraw()}))}),(function(t){console.log(t),void 0!==i&&i()})),data:n,ready:s}},s.scrollBottom=function(t,e,a){e||(t.scrollTop=t.scrollHeight);var i=t.scrollHeight-a.prevHeight||0;t.scrollHeight-t.clientHeight-t.scrollTop<i+10&&(t.scrollTop=t.scrollHeight),a.prevHeight=t.scrollHeight},s.scrollBottom2=function(t,e,a){e||(t.scrollTop=t.scrollHeight);var i=t.scrollHeight-a.prevHeight||0;t.scrollHeight-t.clientHeight-t.scrollTop<i+60&&(t.scrollTop=t.scrollHeight),a.prevHeight=t.scrollHeight},s.setsVal=function(t){return function(e){m.withAttr("value",t)(e),m.redraw.strategy("none")}},s.markRead=function(t){i.data.chat[t].read===!1&&(i.send(i.sendData("mr",{uid:i.data.chat[t].user.id,mv:i.data.chat[t].chat[i.data.chat[t].chat.length-1].mv})),i.data.chat[t].read=!0)},s.focusById=function(t){setTimeout((function e(){void 0!=document.getElementById(t)?(console.log("run focus OK: "+t),document.getElementById(t).focus()):(console.log("running focus: "+t),setTimeout(e,100))}),100)},s.signin=function(){$(".ui.modal.sign-in").modal({onShow:function(){var t=$(this).children().first();t.load("/login",(function(e,a,i){"success"==a&&(t.removeClass("loading"),$(".sign-in .referrer").attr("value",window.location.pathname))}))},onHide:function(){$("body").removeClass("dimmable");var t=$(this).children().first();t.addClass("loading")}}).modal("show")},window.signin=s.signin,s.signup=function(){$(".ui.modal.sign-up").modal({onShow:function(){var t=$(this).children().first();t.load("/signup",(function(e,a,i){"success"==a&&(t.removeClass("loading"),$(".sign-up .referrer").attr("value",window.location.pathname))}))},onHide:function(){$("body").removeClass("dimmable");var t=$(this).children().first();t.addClass("loading")}}).modal("show")},window.signup=s.signup,s.time=function(t){return moment.unix(t/1e3).fromNow()},s.showPost=function(t){$(".ui.modal.show-post").modal({onVisible:function(){$(".ui.modal.show-post").modal("refresh")},onHide:function(){m.route("/"),i.data.post.list[i.arrayObjectIndexOf(i.data.post.list,t,"id")]=i.post().post,i.send(i.sendData("unSubPost",{})),i.request.ready(!1),rd.home((function(){m.redraw()}))}}).modal("show")},e.exports=s},{"../ws/_wsCtrl.js":16}],2:[function(t,e,a){var i=t("../ws/_wsCtrl.js"),n=t("./api.msx"),s={controller:function(){n.rd("Controller: Chat");var t=this;m.redraw.strategy("diff"),t.showChatDock=!0,t.toggleChatDock=function(){t.showChatDock=!t.showChatDock},t.makechat=function(t){rd.right((function(){var e=i.getPosChat(t);i.data.chat[e].display=!0,i.data.chat[e].hide=!1,n.focusById(i.data.chat[e].user.id),m.redraw()}))},t.toggleChat=function(t){i.data.chat[t].hide=!i.data.chat[t].hide;var e=i.arrayObjectIndexOf2(i.storage.chat,i.data.chat[t].user.id,"id");e>-1&&(i.storage.chat[e].hide=i.data.chat[t].hide,$.localStorage.set("chat:"+i.userId,i.storage.chat))},t.stopChat=function(t){i.data.chat[t].display=!1,i.data.chat[t].input("");var e=i.arrayObjectIndexOf2(i.storage.chat,i.data.chat[t].user.id,"id");e>-1&&(i.storage.chat.splice(e,1),$.localStorage.set("chat:"+i.userId,i.storage.chat))},t.add=function(t){var e=i.data.chat[t].input().trim();e&&i.send(i.sendData("m",{to:i.data.chat[t].user.id,mes:e})),i.data.chat[t].input("")},t.save=function(e){13==e.keyCode?t.add():m.redraw.strategy("none")}},view:function(t){return n.rd("redraw Chat: "+redraw.right),redraw.right++,{tag:"div",attrs:{},children:[{tag:"div",attrs:{id:"dock-icon",className:i.friendFlag?"hide":"",onclick:function(){i.friendFlag=!0,rd.right((function(){m.redraw()}))}},children:[{tag:"i",attrs:{className:"blue huge comments outline icon"}}]},i.userId.length>0?t.showChatDock?{tag:"div",attrs:{id:"user-list",className:"ui gray segment pad0 sha3 mar0 "+(i.friendFlag?"user-show":"user-hide")},children:[{tag:"span",attrs:{class:"dock-close",onclick:function(){i.friendFlag=!1,rd.right((function(){m.redraw()}))}},children:[" X "]},{tag:"div",attrs:{className:"ui segment  noSha noBor pad0"},children:[{tag:"div",attrs:{className:"ui top attached tabular two item  menu",style:"margin-top: 5px;"},children:[{tag:"a",attrs:{className:(i.data.showOnline?"":"active")+" item pad0",onclick:function(){i.data.showOnline=!1,i.data.initAllFriends||i.send(i.sendData("getAllFriends",{})),rd.right((function(){m.redraw()}))}},children:["All Friends"]},{tag:"a",attrs:{className:(i.data.showOnline?"active":"")+" item pad0",onclick:function(){i.data.showOnline=!0,rd.right((function(){m.redraw()}))}},children:["Online (",i.data.userOnline.length,")"]}]},{tag:"div",attrs:{className:(i.data.showOnline||i.data.initAllFriends?"":"loading")+" ui segment  noSha noBor pad0 mh500"},children:[{tag:"div",attrs:{className:" ui tiny middle aligned selection list noSha noBor "},children:[i.data.showOnline?i.data.userOnline.map((function(e){return{tag:"a",attrs:{className:" item ulptr",href:"/@/"+e.id,config:function(a,n){$(a).click((function(){i.userId.length>0&&i.userId!==e.id&&t.makechat(e)})),n||$(a).click((function(){return!1}))}},children:[{tag:"img",attrs:{className:"ui avatar image",src:e.avatar.length>0?i.static+"/getimage/small/"+e.avatar:i.defaultAvata}},{tag:"div",attrs:{className:"content"},children:[{tag:"div",attrs:{className:"header"},children:[e.name]}]}]}})):i.data.allFriends.map((function(e){return{tag:"a",attrs:{className:" item ulpt",href:"/@/"+e.id,config:function(a,n){$(a).click((function(){i.userId.length>0&&i.userId!==e.id&&t.makechat(e)})),n||$(a).click((function(){return!1}))}},children:[{tag:"img",attrs:{className:"ui avatar image",src:e.avatar.length>0?i.static+"/getimage/small/"+e.avatar:i.defaultAvata}},{tag:"div",attrs:{className:"content"},children:[{tag:"div",attrs:{className:"header"},children:[e.name]}]}]}}))]}]}]}]}:{tag:"div",attrs:{id:"user-list"},children:[{tag:"div",attrs:{className:"ui top attached inverted header chat-title",onclick:function(){rd.right(t.toggleChatDock())}},children:["Online"]}]}:"",{tag:"div",attrs:{id:"dock-bot",class:i.friendFlag?"uShow":"uHide"},children:[i.data.chat.map((function(e,a){return e.display?{tag:"div",attrs:{className:"chatWr "+(e.hide?"w2":"w1")},children:[{tag:"div",attrs:{className:"ui top attached blue inverted header chat-title2"+(e.read?"":" unread"),style:e.hide?"":"display: none",onclick:function(){rd.right(t.toggleChat(a))}},children:[e.user.name,{tag:"i",attrs:{className:"remove icon close-chat",onclick:function(){rd.right(t.stopChat(a))}}}]},{tag:"div",attrs:{className:"raised chatboxWr",style:e.hide?"display: none":""},children:[" ",{tag:"div",attrs:{className:"ui segment noSha"},children:[{tag:"div",attrs:{className:"ui top attached inverted header chat-title sha2"+(e.read?"":" unread"),onclick:function(){rd.right(t.toggleChat(a))}},children:[e.user.name,{tag:"i",attrs:{className:"setting icon setting-chat"}},{tag:"i",attrs:{className:"remove icon close-chat",onclick:function(){rd.right(t.stopChat(a))}}}]},{tag:"div",attrs:{className:"ui form"},children:[{tag:"div",attrs:{className:"field"},children:[{tag:"div",attrs:{className:"chat-box",config:n.scrollBottom,onclick:local(["nav","right"],(function(){n.markRead(a)}))},children:[e.chat.map((function(t,a){return{tag:"div",attrs:{},children:[e.init?{tag:"div",attrs:{className:"loading_chat"},children:['"Loading previous ..."']}:"",{tag:"div",attrs:{className:t.f.id==i.userId?"ui left pointing basic label chat-left":"ui right pointing basic label chat-right"},children:[{tag:"div",attrs:{className:"mes"},children:[m.trust(n.post(t.mes))]}]}]}}))]},{tag:"textarea",attrs:{className:"auto-size new-comment",id:e.user.id,rows:"1",onfocus:function(){rd.right((function(){n.markRead(a)}))},config:function(t,e,n){e||($(t).on("input",(function(){i.data.chat[a].input($(t).val())})),$(t).textareaAutoSize(),$(t).attrchange({callback:function(e){var a=t.previousSibling,i=$(a);i.scrollTop()+i.innerHeight()>=t.previousSibling.scrollHeight?(i.css("height",273-$(t).outerHeight()),a.scrollTop=a.scrollHeight):i.css("height",273-$(t).outerHeight())}})),t.value=i.data.chat[a].input(),t.value.length<1&&$(t).css("height","30px")},onkeypress:function(e){if(13==e.keyCode&&!e.shiftKey){if(m.redraw.strategy("none"),i.data.chat[a].input().length<1)return!1;var n=e.target||e.srcElement,s=n.previousSibling;return s.scrollTop=s.scrollHeight,t.add(a),!1}if(m.redraw.strategy("none"),13==e.keyCode&&e.shiftKey&&i.data.chat[a].input().length<1)return!1}}}]}]}]}]}]}:""}))]}]}}};e.exports=s},{"../ws/_wsCtrl.js":16,"./api.msx":1}],3:[function(t,e,a){var i=t("../ws/_wsCtrl.js"),n=t("./api.msx"),s={controller:function(){m.redraw.strategy("diff"),$.cookie("url",m.route(),{path:"/"});var t=this;t.param=m.prop(m.route.param("roomId")),i.send(i.sendData("initChat",{t:"chatrooms"}));var e=setInterval((function(){i.send(i.sendData("sub",{t:"chatrooms"}))}),3e4);t.setupHotQuestion=function(){i.initHotQuestion=!0},i.request2=n.requestWithFeedback2({method:"GET",url:"/qa/hotquestion"},i.hotQuestion,t.setupHotQuestion),t.onunload=function(){i.data.chatrooms={},i.send(i.sendData("unSub",{t:"chatrooms"})),clearInterval(e)},t.roomList=[{id:"01",name:"Room 1",description:""},{id:"02",name:"Room 2",description:""},{id:"03",name:"Room 3",description:""},{id:"04",name:"Room 4",description:""},{id:"05",name:"Room 5",description:""}],rd.chatroom()},view:function(t){return{tag:"div",attrs:{className:"ui grid main-content"},children:[{tag:"div",attrs:{className:"eleven wide column"},children:[{tag:"div",attrs:{className:"ui segment segWr mh500"},children:[{tag:"div",attrs:{className:"ui grid"},children:[t.roomList.map((function(t){return{tag:"div",attrs:{className:"sixteen wide column"},children:[{tag:"div",attrs:{className:"ui segment"},children:[{tag:"div",attrs:{className:"ui relaxed divided list"},children:[{tag:"a",attrs:{href:"/chatroom/"+t.id,className:"item",config:m.route},children:[{tag:"span",attrs:{className:"fr"},children:[{tag:"div",attrs:{className:"item"},children:[{tag:"i",attrs:{className:"tiny users left middle aligned icon"},children:[i.getRooms(t.id).u]}]},{tag:"i",attrs:{className:"tiny plug left middle aligned icon"},children:[i.getRooms(t.id).c]}]},{tag:"i",attrs:{className:"large pointing right middle aligned icon"}},{tag:"div",attrs:{className:"content"},children:[{tag:"div",attrs:{className:"header"},children:[t.name]},{tag:"div",attrs:{className:"description"},children:[t.description]}]}]}]}]}]}}))]},r()]}]},{tag:"div",attrs:{className:"five wide column mh500"},children:[{tag:"div",attrs:{className:"ui  home-post-Wr mh500"},children:[{tag:"div",attrs:{className:"trending"},children:[{tag:"h3",attrs:{},children:["Câu hỏi HOT"]},i.initHotQuestion?{tag:"ul",attrs:{},children:[i.hotQuestion().map((function(t){return{tag:"li",attrs:{},children:[{tag:"a",attrs:{className:"route",href:"/qa/"+t.id},children:[t.question]}]}}))]}:"loading !!"]}]}]}]}}},r=function(){return{tag:"div",attrs:{className:"ui form fluid popup create-room"},children:[{tag:"div",attrs:{className:"two fields"},children:[{tag:"div",attrs:{className:"field"},children:[{tag:"label",attrs:{},children:["Tên phòng"]},{tag:"input",attrs:{type:"text",placeholder:"Tên phòng"}}]},{tag:"div",attrs:{className:"field"},children:[{tag:"label",attrs:{},children:["Mô tả"]},{tag:"input",attrs:{type:"text",placeholder:"Mô tả"}}]}]},{tag:"div",attrs:{className:"two fields"},children:[{tag:"div",attrs:{className:"grouped field"},children:[{tag:"label",attrs:{},children:["Level"]},{tag:"div",attrs:{className:"field"},children:[{tag:"div",attrs:{className:"ui radio checkbox"},children:[{tag:"input",attrs:{type:"radio",name:"fruit",tabindex:"0",className:"hidden"}},{tag:"label",attrs:{},children:["Elementary"]}]}]},{tag:"div",attrs:{className:"field"},children:[{tag:"div",attrs:{className:"ui radio checkbox"},children:[{tag:"input",attrs:{type:"radio",name:"fruit",tabindex:"0",className:"hidden"}},{tag:"label",attrs:{},children:["Intermediate"]}]}]},{tag:"div",attrs:{className:"field"},children:[{tag:"div",attrs:{className:"ui radio checkbox"},children:[{tag:"input",attrs:{type:"radio",name:"fruit",tabindex:"0",className:"hidden"}},{tag:"label",attrs:{},children:["Advanced"]}]}]},{tag:"div",attrs:{className:"field"},children:[{tag:"div",attrs:{className:"ui radio checkbox"},children:[{tag:"input",attrs:{type:"radio",name:"fruit",tabindex:"0",className:"hidden"}},{tag:"label",attrs:{},children:["Proficient"]}]}]}]},{tag:"div",attrs:{className:"grouped field"},children:[{tag:"label",attrs:{},children:["Kỹ năng"]},{tag:"div",attrs:{className:"field"},children:[{tag:"div",attrs:{className:"ui radio checkbox"},children:[{tag:"input",attrs:{type:"radio",name:"fruit",tabindex:"0",className:"hidden"}},{tag:"label",attrs:{},children:["Speaking"]}]}]},{tag:"div",attrs:{className:"field"},children:[{tag:"div",attrs:{className:"ui radio checkbox"},children:[{tag:"input",attrs:{type:"radio",name:"fruit",tabindex:"0",className:"hidden"}},{tag:"label",attrs:{},children:["Listening"]}]}]},{tag:"div",attrs:{className:"field"},children:[{tag:"div",attrs:{className:"ui radio checkbox"},children:[{tag:"input",attrs:{type:"radio",name:"fruit",tabindex:"0",className:"hidden"}},{tag:"label",attrs:{},children:["Wriring"]}]}]},{tag:"div",attrs:{className:"field"},children:[{tag:"div",attrs:{className:"ui radio checkbox"},children:[{tag:"input",attrs:{type:"radio",name:"fruit",tabindex:"0",className:"hidden"}},{tag:"label",attrs:{},children:["Reading"]}]}]}]}]},{tag:"div",attrs:{className:"field"},children:[{tag:"button",attrs:{className:"button"},children:["Create"]}]}]}};e.exports=s},{"../ws/_wsCtrl.js":16,"./api.msx":1}],4:[function(t,e,a){"user strict";var i=t("./nav.msx"),n=t("./home.msx"),s=t("./qa.msx"),r=t("./chatroom.msx"),o=t("./user.msx"),d=t("./userSetting.msx"),c=t("./room.msx"),l=t("./footer.msx");window.route=function(t){return{controller:function(){return m.redraw.strategy("diff"),new t.controller},view:t.view}},window.target=[],window.tenant=function(t,e){return target.push(t),{controller:e.controller,view:function(a){return target.indexOf(t)!=-1||"all"==t?(target.splice(target.indexOf(t),1),e.view(a)):{subtree:"retain"}}}},window.local=function(t,e){return function(a){t.map((function(t){window.target.indexOf(t)<0&&window.target.push(t)})),void 0==e&&(e=function(){}),e.call(this,a)}},window.rd={nav:function(t){local(["nav"],t).call()},home:function(t){local(["home"],t).call()},qa:function(t){local(["qa"],t).call()},app:function(t){local(["app"],t).call()},right:function(t){local(["right"],t).call()},chatroom:function(t){local(["chatroom"],t).call()},room:function(t){local(["room"],t).call()},user:function(t){local(["user"],t).call()},setting:function(t){local(["setting"],t).call()},all:function(t){local(["home","qa","nav","app","right","chatroom","room","user","setting"],t).call()}},window.Chat=t("./chat.msx"),window.Loading={controller:function(){},view:function(){return console.log("render loading!!"),m("","LOADING")}},vis((function(){vis()&&(console.log("visible"),rd.all((function(){m.redraw()})))}));window.initRoute=function(){m.route(document.getElementById("app"),"/",{"/":tenant("home",route(n)),"/post/:postId":tenant("home",route(n)),"/qa":tenant("qa",route(s)),"/qa/new":tenant("qa",route(s)),"/qa/:questionId":tenant("qa",route(s)),"/chatroom":tenant("chatroom",route(r)),"/chatroom/:roomId":tenant("room",route(c)),"/settings":tenant("setting",route(d)),"/@/:user":tenant("user",route(o))}),$(".loaderWr").remove()},window.initComponent=function(){m.mount(document.getElementById("nav"),tenant("nav",i)),m.mount(document.getElementById("footer"),tenant("footer",l)),m.mount(document.getElementById("rightContainer"),tenant("right",Chat))}},{"./chat.msx":2,"./chatroom.msx":3,"./footer.msx":5,"./home.msx":6,"./nav.msx":11,"./qa.msx":12,"./room.msx":13,"./user.msx":14,"./userSetting.msx":15}],5:[function(t,e,a){var i=(t("../ws/_wsCtrl.js"),t("./api.msx"),{controller:function(){},view:function(t){return{tag:"div",attrs:{className:"footer"}}}});e.exports=i},{"../ws/_wsCtrl.js":16,"./api.msx":1}],6:[function(t,e,a){var i=t("../ws/_wsCtrl.js"),n=t("./api.msx"),s={controller:function(){m.redraw.strategy("diff"),$.cookie("url",m.route(),{path:"/"}),n.rd("Controller: Home");var t=this;t.add=function(e){t.inputPost("")},t.inputPost=m.prop(""),t.inputComment=m.prop(""),i.data.post.init||i.send(i.sendData("initPost",{})),t.setup=function(){i.post().comment=i.post().comment.reverse(),i.post().post.commentLoading=!1,i.post().post.commentShow=i.post().comment.length,i.post().comment.forEach((function(t){i.post().post.commentShow+=t.childCount})),console.log(i.post().post.commentShow)},t.setupNewQuestion=function(){i.initNewQuestion=!0},t.setupHotQuestion=function(){i.initHotQuestion=!0},i.request1=n.requestWithFeedback2({method:"GET",url:"/qa/newquestion"},i.newQuestion,t.setupNewQuestion),i.request2=n.requestWithFeedback2({method:"GET",url:"/qa/hotquestion"},i.hotQuestion,t.setupHotQuestion),t.addComment=function(t,e){var a=e().trim();a&&(i.send(i.sendData("comment",{parent:"post",id:t,c:a})),e("")),rd.home((function(){m.redraw()}))},t.moreComment=function(t,e){i.send(i.sendData("moreComment",{id:t,time:e}))},t.addChildComment=function(t,e,a){var n=e().trim();n&&(i.send(i.sendData("comment",{parent:"comment",postId:a,id:t,c:n})),e("")),rd.home((function(){m.redraw()}))},void 0!==m.route.param("postId")&&(i.request=n.requestWithFeedback2({method:"GET",url:"/viewpost/"+m.route.param("postId")},i.post,t.setup),i.send(i.sendData("subPost",{id:m.route.param("postId")}))),t.post=m.prop({}),t.onunload=function(){void 0!==i.request&&i.request.ready()&&(i.data.post.list[i.arrayObjectIndexOf(i.data.post.list,i.post().post.id,"id")]=i.post().post,i.send(i.sendData("unSubPost",{})),i.request.ready(!1))},rd.home((function(){console.log("redraw home!"),m.redraw()}))},view:function(t){return n.rd("home:"+redraw.home),{tag:"div",attrs:{className:"ui grid  main-content"},children:[{tag:"div",attrs:{className:"three wide column"},children:[{tag:"div",attrs:{className:"ui  home-post-Wr mh500"},children:[{tag:"div",attrs:{className:"trending"},children:[{tag:"h3",attrs:{},children:["Câu hỏi mới"]},i.initNewQuestion?{tag:"ul",attrs:{},children:[i.newQuestion().map((function(t){return{tag:"li",attrs:{},children:[{tag:"a",attrs:{className:"route",href:"/qa/"+t.id},children:[t.question]}]}}))]}:"loading !!"]}]},{tag:"div",attrs:{className:"ui  home-post-Wr mh300"}}]},{tag:"div",attrs:{className:"nine wide column"},children:[i.data.post.init?void 0!==m.route.param("postId")?s.ShowPost(t):[{tag:"div",attrs:{className:"ui home-post-Wr "},children:[{tag:"div",attrs:{className:"ui form postWr postContainer"},children:[{tag:"div",attrs:{className:"field"},children:[{tag:"textarea",attrs:{className:"auto-size new-post",rows:"2",placeholder:"What's on your mind?",config:function(e,a,s){a||(0==i.userId.length&&$(e).on("click input",(function(){n.signin(),e.value=""})),$(e).textareaAutoSize(),$(e).on("input",(function(){t.inputPost($(e).val())}))),e.value=t.inputPost(),e.value.length<1},onkeypress:function(e){if(13!=e.keyCode||e.shiftKey){if(m.redraw.strategy("none"),13==e.keyCode&&e.shiftKey&&t.inputPost().length<1)return!1}else if(m.redraw.strategy("none"),t.inputPost().length<1)return!1}},children:[t.inputPost()]}]},{tag:"div",attrs:{className:"post"},children:[{tag:"button",attrs:{className:"ui mini primary button",onclick:function(e){t.inputPost().trim().length>0&&(m.redraw.strategy("none"),$(".postWr").addClass("loading"),$.ajax({type:"POST",url:"/post",data:JSON.stringify({content:t.inputPost()}),contentType:"application/json",dataType:"text",success:function(e){t.inputPost(""),$(".new-post").css("height",41),$(".postWr").removeClass("loading"),rd.home((function(){m.redraw()}))}}))}},children:["Post"]},{tag:"span",attrs:{className:"clear"}}]}]}]},i.data.post.list.map((function(e){return s.post(e,t)})),1460882188511===i.data.post.list[i.data.post.list.length-1].published?"":{tag:"div",attrs:{className:"ui button",onclick:function(){console.log(i.data.post.list[i.data.post.list.length-1]),i.send(i.sendData("morePost",{time:i.data.post.list[i.data.post.list.length-1].published}))}},children:["More post"]}]:i.userId.length>0?{tag:"div",attrs:{className:"ui home-post-Wr "},children:[{tag:"div",attrs:{className:"ui segment loading mh300 noBor noSha"}}]}:{tag:"div",attrs:{className:"ui home-post-Wr "},children:[{tag:"div",attrs:{className:"ui segment mh300 noBor noSha",style:"text-align: center"},children:["Please login to see posts!"]}]}]},{tag:"div",attrs:{className:"four wide column"},children:[{tag:"div",attrs:{className:"ui  home-post-Wr mh500"},children:[{tag:"div",attrs:{className:"trending"},children:[{tag:"h3",attrs:{},children:["Câu hỏi HOT"]},i.initHotQuestion?{tag:"ul",attrs:{},children:[i.hotQuestion().map((function(t){return{tag:"li",attrs:{},children:[{tag:"a",attrs:{className:"route",href:"/qa/"+t.id},children:[t.question]}]}}))]}:"loading !!"]}]}]}]}}};s.post=function(t,e){return{tag:"div",attrs:{className:"ui home-post-Wr"},children:[{tag:"div",attrs:{className:"ui postContainer postDemo"},children:[{tag:"div",attrs:{className:"ui list"},children:[{tag:"div",attrs:{className:"item"},children:[{tag:"span",attrs:{className:"fl avatar"},children:[{tag:"a",attrs:{className:"route ulpt",href:"/@/"+t.user.id},children:[{tag:"img",attrs:{className:"image",src:t.user.avatar.length>0?i.static+"/getimage/thumb/"+t.user.avatar:i.defaultAvata}}]}]},{tag:"div",attrs:{className:"content"},children:[{tag:"span",attrs:{className:"header"},children:[{tag:"a",attrs:{className:"name route ulpt",href:"/@/"+t.user.id},children:[t.user.name]}]},{tag:"div",attrs:{className:"description"},children:[n.time(t.published)]}]}]}]},{tag:"div",attrs:{className:"content-post"},children:[m.trust(n.post(t.content))]},{tag:"div",attrs:{className:"ui horizontal list extra-post"},children:[{tag:"div",attrs:{className:"item"},children:[{tag:"a",attrs:{className:"mini ui  basic button","data-content":"like","data-position":"top left",config:function(t,e){e||$(t).popup({inline:!0})},onclick:function(){$.post((void 0===t.likes||t.likes.length<0?"/like":"/unlike")+"/post/"+t.id,(function(e){"liked"===e?(t.likeCount+=1,t.likes=[i.userId]):"unliked"===e&&(t.likeCount-=1,t.likes=void 0),rd.home((function(){m.redraw()}))}))}},children:[{tag:"i",attrs:{className:(void 0===t.likes||t.likes.length<0?"":"blue")+" heart icon"}},t.likeCount]}]},{tag:"div",attrs:{className:"item"},children:[{tag:"a",attrs:{className:"mini ui basic button","data-content":"comment","data-position":"top left",config:function(t,e){e||$(t).popup({inline:!0})},onclick:function(e){void 0===m.route.param("post")&&(m.route("/post/"+t.id),rd.home((function(){m.redraw()})))}},children:[{tag:"i",attrs:{className:"comment icon"}},t.commentCount]}]}]}]},{tag:"span",attrs:{className:"right floated post-arrow"},children:[{tag:"a",attrs:{className:"route","data-content":void 0===m.route.param("postId")?"View":"Back","data-position":"top left",href:void 0===m.route.param("postId")?"/post/"+t.id:"/",config:function(t,e){e||$(t).popup({inline:!0})}},children:[{tag:"i",attrs:{className:"large  grey arrow "+(void 0===m.route.param("postId")?"right":"left")+" icon"}}]}]}]}},s.ShowPost=function(t){return void 0!==i.request&&i.request.ready()?{tag:"div",attrs:{className:"ui home-post-Wr"},children:[{tag:"div",attrs:{className:"ui postContainer postDemo"},children:[s.post(i.post().post),{tag:"div",attrs:{id:"comment"},children:[{tag:"div",attrs:{className:"ui threaded comments"},children:[{tag:"h2",attrs:{},children:["Comments"]},i.post().post.commentCount-i.post().post.commentShow>0?[{tag:"a",attrs:{href:"#comment",style:"color: #3b5998; font-size: 13px !important;",onclick:function(e){e.target||e.srcElement;t.moreComment(i.post().post.id,i.post().comment[0].time)}},children:["View more comments"]}]:"",i.post().comment.map((function(e){return{tag:"div",attrs:{className:"comment"},children:[{tag:"span",attrs:{className:"avatar"},children:[{tag:"a",attrs:{className:"route ulpt",href:"/@/"+e.user.id},children:[{tag:"img",attrs:{src:e.user.avatar.length>0?i.static+"/getimage/small/"+e.user.avatar:i.defaultAvata}}]}]},{tag:"div",attrs:{className:"content"},children:[{tag:"span",attrs:{className:"author"},children:[{tag:"a",attrs:{className:"fl route ulpt",href:"/@/"+e.user.id},children:[e.user.name]}]},{tag:"div",attrs:{className:"metadata"},children:[{tag:"span",attrs:{className:"date"},children:[n.time(e.time)]}]},{tag:"div",attrs:{className:"text"},children:[m.trust(n.post(e.comment))]},{tag:"div",attrs:{className:"actions"},children:[{tag:"a",attrs:{className:"reply",onclick:function(){e.replay=!0,e.input=m.prop(""),rd.home((function(){m.redraw()}))}},children:["Reply"]}]}]},e.replay||e.children.length>0?[e.children.length>0?{tag:"div",attrs:{className:"comments"},children:[e.children.map((function(t){return{tag:"div",attrs:{className:"comment"},children:[{tag:"span",attrs:{className:"avatar"},children:[{tag:"a",attrs:{className:"route ulpt",href:"/@/"+t.user.id},children:[{tag:"img",attrs:{src:t.user.avatar.length>0?i.static+"/getimage/small/"+t.user.avatar:i.defaultAvata}}]}]},{tag:"div",attrs:{className:"content"},children:[{tag:"span",attrs:{className:"author"},children:[{tag:"a",attrs:{className:"fl route ulpt",href:"/@/"+t.user.id},children:[t.user.name]}]},{tag:"div",attrs:{className:"metadata"},children:[{tag:"span",attrs:{className:"date"},children:[n.time(t.time)]}]},{tag:"div",attrs:{className:"text"},children:[m.trust(n.post(t.comment))]},{tag:"div",attrs:{className:"actions"},children:[{tag:"a",attrs:{className:"reply",onclick:function(){e.replay=!0,e.input=m.prop(""),rd.home((function(){m.redraw()}))}},children:["Reply"]}]}]}]}}))]}:"",e.replay?{tag:"div",attrs:{className:"comments childComment"},children:[s.Comment(t,t.addChildComment,e.id,e.input,i.post().post.id)]}:""]:""]}}))]},{tag:"div",attrs:{className:"ui threaded comments"},children:[s.Comment(t,t.addComment,i.post().post.id,t.inputComment)]}]}]}]}:{tag:"div",attrs:{className:"ui home-post-Wr"},children:[{tag:"div",attrs:{className:"ui postContainer postDemo"},children:[{tag:"div",attrs:{className:"ui segment loading",style:"min-height: 600px;"}}]}]}},s.Comment=function(t,e,a,s,r){return{tag:"div",attrs:{className:"comment"},children:[{tag:"a",attrs:{className:"avatar"},children:[{tag:"img",attrs:{src:i.avatar.length>0?i.static+"/getimage/small/"+i.avatar:i.defaultAvata,height:"35",width:"35"}}]},{tag:"div",attrs:{className:"ui form content"},children:[{tag:"div",attrs:{className:"field",style:"display:inline"},children:[{tag:"textarea",attrs:{rows:"1",style:"max-height: 92px",config:function(t,e,a){e||(0==i.userId.length?$(t).on("click input",(function(){n.signin(),t.value=""})):$(t).on("input",(function(){s($(t).val())})),$(t).textareaAutoSize()),t.value=s(),t.value.length<1&&$(t).css("height","41")},onkeypress:function(t){if(13==t.keyCode&&!t.shiftKey){if(m.redraw.strategy("none"),s().length<1)return console.log("chat length < 1"),!1;t.target||t.srcElement;return void 0!==r?e(a,s,r):e(a,s),!1}if(m.redraw.strategy("none"),13==t.keyCode&&t.shiftKey&&s().length<1)return!1},placeholder:"Click here to type a comment"}}]}]}]}},e.exports=s},{"../ws/_wsCtrl.js":16,"./api.msx":1}],7:[function(t,e,a){var i=t("../../ws/_wsCtrl.js"),n=(t(".././api.msx"),function(t){return[{tag:"a",attrs:{className:"item nofity  message-button fix-icon","data-content":"Friend Requests","data-position":"bottom right",onclick:function(){rd.nav(t.displayFriend())},config:function(t,e){if(!e){var a=$(t);a.popup({inline:!0,on:"manual"}),a.hover((function(){i.data.notify.display||a.popup("show")})),a.on("click mouseleave",(function(){a.popup("hide")}))}}},children:[{tag:"a",attrs:{href:"javascript:void(0)"},children:[{tag:"i",attrs:{className:"large icon add user users-icon"}}]},i.data.makeFriend.n>0?{tag:"div",attrs:{className:"floating ui red label num-label"},children:[i.data.makeFriend.n]}:""]},{tag:"div",attrs:{className:"notifyWr"},children:[i.data.makeFriend.display?{tag:"div",attrs:{className:"inNotify",config:function(t,e,a){e||(console.log("////"),$(t).on("mouseleave",(function(){!$(".menu:hover").length>0&&($(t).unbind("mouseleave"),$(".menu").unbind("mouseleave"),i.data.makeFriend.display=!1,rd.nav((function(){m.redraw()})))})),$(".menu").on("mouseleave",(function(){!$(t).filter(":hover").length>0&&($(t).unbind("mouseleave"),$(".menu").unbind("mouseleave"),i.data.makeFriend.display=!1,rd.nav((function(){m.redraw()})))})))}},children:[{tag:"div",attrs:{className:"corner-right"},children:[{tag:"div",attrs:{className:"tr"}}]},{tag:"div",attrs:{className:"ui raised  attracted segment notify-content sha3 pad0"},children:[{tag:"div",attrs:{className:"ui top attracted label tran"},children:["Friend Requests"]},i.data.makeFriend.init?{tag:"div",attrs:{},children:[i.data.makeFriend.listRequests.map((function(t){return{tag:"div",attrs:{className:"notifyFriend clearfix"},children:[{tag:"span",attrs:{className:"ui list fleft"},children:[{tag:"div",attrs:{className:"item"},children:[{tag:"img",attrs:{className:"ui avatar image",src:t.avatar.length>0?i.static+"/getimage/thumb/"+t.avatar:i.defaultAvata}},{tag:"div",attrs:{className:"content"},children:[{tag:"a",attrs:{className:"header",href:"/@/"+t.id,config:m.route},children:[t.name]},{tag:"div",attrs:{className:"description"},children:["wanting to make friend with you"]}]}]}]},{tag:"span",attrs:{className:"mini ui buttons fright"},children:[{tag:"a",attrs:{href:"/rel/request/"+t.id,className:"ui positive button",onclick:function(e){e.preventDefault(),$.post($(this).attr("href"),(function(e){i.data.makeFriend.listRequests=i.data.makeFriend.listRequests.filter((function(e){return e.id!=t.id})),rd.nav((function(){i.data.makeFriend.listRequests.length<1&&(i.data.makeFriend.display=!1),m.redraw()}))}))}},children:["Cormfirm"]},{tag:"div",attrs:{className:"or"}},{tag:"a",attrs:{className:"ui  button",href:"/rel/reject/"+t.id,onclick:function(e){e.preventDefault(),$.post($(this).attr("href"),(function(e){i.data.makeFriend.listRequests=i.data.makeFriend.listRequests.filter((function(e){return e.id!=t.id})),rd.nav((function(){i.data.makeFriend.listRequests.length<1&&(i.data.makeFriend.display=!1),m.redraw()}))}))}},children:["Reject"]}]}]}}))]}:"LOADING"]}]}:""]}]});e.exports=n},{"../../ws/_wsCtrl.js":16,".././api.msx":1}],8:[function(t,e,a){var i=(t("../../ws/_wsCtrl.js"),t(".././api.msx")),n=function(t){return[{tag:"a",attrs:{className:"item fix-icon",onclick:function(){i.signin()}},children:[{tag:"i",attrs:{className:"large icon user"}},"Login"]},{tag:"div",
attrs:{className:"notifyWr"},children:[t.displayLogin?{tag:"div",attrs:{className:"inLogin",config:function(e,a,i){function n(){$(e).is(":hover")||$(".login-button").is(":hover")||(t.displayLogin=!1,$(document).unbind("click",n),rd.nav((function(){m.redraw()})))}a||$(document).on("click",n)}},children:[{tag:"div",attrs:{className:"corner-right"},children:[{tag:"div",attrs:{className:"tr"}}]},{tag:"div",attrs:{className:"ui segment notify-content sha3"},children:[{tag:"form",attrs:{className:"ui small form",action:"/login?referrer=",method:"POST"},children:[{tag:"div",attrs:{className:"field"},children:[{tag:"div",attrs:{className:"ui left icon input"},children:[{tag:"i",attrs:{className:"user icon"}},{tag:"input",attrs:{type:"text",pattern:"^[\\w-]+$",required:"required",name:"username",id:"username",placeholder:"User name"}}]}]},{tag:"div",attrs:{className:"field"},children:[{tag:"div",attrs:{className:"ui left icon input"},children:[{tag:"i",attrs:{className:"lock icon"}},{tag:"input",attrs:{type:"password",required:"required",name:"password",id:"password",placeholder:"Password"}}]}]},{tag:"div",attrs:{className:"ui right floated tiny buttons"},children:[{tag:"button",attrs:{className:"ui positive button",type:"submit"},children:["Login"]},{tag:"div",attrs:{className:"or","data-text":"Or"}},{tag:"a",attrs:{href:"javascript:void(0)",className:"ui teal button",config:function(e,a,n){a||$(e).on("click",(function(){i.signup(),rd.nav((function(){t.displayLogin=!1,m.redraw()}))}))}},children:["Signup"]}]}]}]}]}:""]}]};e.exports=n},{"../../ws/_wsCtrl.js":16,".././api.msx":1}],9:[function(t,e,a){var i=t("../../ws/_wsCtrl.js"),n=t(".././api.msx"),s=function(t){return[{tag:"a",attrs:{className:"item nofity  message-button pre-show-messages fix-icon","data-content":"Messages","data-position":"bottom right",onclick:function(){rd.nav(t.displayNofity())},config:function(t,e){if(!e){var a=$(t);a.popup({inline:!0,on:"manual"}),a.hover((function(){i.data.makeFriend.display||a.popup("show")})),a.on("click mouseleave",(function(){a.popup("hide")}))}}},children:[{tag:"a",attrs:{href:"javascript:void(0)"},children:[{tag:"i",attrs:{className:"large mail icon"}}]},i.data.notify.n>0?{tag:"div",attrs:{className:"floating ui red label num-label"},children:[i.data.notify.n]}:""]},{tag:"div",attrs:{className:"notifyWr"},children:[i.data.notify.display?{tag:"div",attrs:{className:"inNotify",config:function(t,e){e||($(t).on("mouseleave",(function(){!$(".menu:hover").length>0&&($(t).unbind("mouseleave"),$(".menu").unbind("mouseleave"),i.data.notify.display=!1,rd.nav((function(){m.redraw()})))})),$(".menu").on("mouseleave",(function(){!$(t).filter(":hover").length>0&&($(t).unbind("mouseleave"),$(".menu").unbind("mouseleave"),i.data.notify.display=!1,rd.nav((function(){m.redraw()})))})))}},children:[{tag:"div",attrs:{className:"corner-right"},children:[{tag:"div",attrs:{className:"tr"}}]},{tag:"div",attrs:{className:"ui raised  attracted segment notify-content sha3 pad0"},children:[{tag:"div",attrs:{className:"ui top attracted label tran"},children:["Inbox (",i.data.notify.n,")"]},i.data.notify.init?{tag:"div",attrs:{},children:[i.data.notify.notifyMessage.map((function(t){return{tag:"div",attrs:{className:"notifyMes clearfix",config:function(e,a,s){$(e).click((function(){local(["nav","right"],(function(){i.data.notify.display=!i.data.notify.display;var e=i.getPosChat(t.user);0==i.data.chat[e].display?(i.data.chat[e].display=!0,i.data.chat[e].hide=!1):1==i.data.chat[e].hide&&(i.data.chat[e].hide=!1),t.n>0&&(i.data.chat[e].read=!1),n.focusById(i.data.chat[e].user.id),m.redraw()})).call()}))}},children:[{tag:"div",attrs:{className:"nleft"}},{tag:"div",attrs:{className:"nright"},children:[{tag:"span",attrs:{className:"notifyName"},children:[t.user.name]},{tag:"span",attrs:{className:"mesNumber"},children:["(",t.n,")"]},{tag:"div",attrs:{className:"lastMes"},children:[t.lm.mes]}]}]}}))]}:"LOADING"]}]}:""]}]};e.exports=s},{"../../ws/_wsCtrl.js":16,".././api.msx":1}],10:[function(t,e,a){var i=t("../../ws/_wsCtrl.js"),n=(t(".././api.msx"),function(t){return[{tag:"a",attrs:{href:"javascript:void(0)",className:"item user-button fix-icon","data-content":"Profile","data-position":"bottom center",onclick:function(){rd.nav(t.toggleUser())},config:function(e,a){if(!a){var i=$(e);i.popup({inline:!0,on:"manual"}),i.hover((function(){t.displayUser||i.popup("show")})),i.on("click mouseleave",(function(){i.popup("hide")}))}}},children:[{tag:"i",attrs:{className:"large user icon"}},i.userName]},{tag:"div",attrs:{className:"notifyWr"},children:[t.displayUser?{tag:"div",attrs:{className:"inUser",config:function(e,a,i){a||($(e).on("mouseleave",(function(){!$(".menu:hover").length>0&&($(e).unbind("mouseleave"),$(".menu").unbind("mouseleave"),t.displayUser=!1,rd.nav((function(){m.redraw()})))})),$(".menu").on("mouseleave",(function(){!$(e).filter(":hover").length>0&&($(e).unbind("mouseleave"),$(".menu").unbind("mouseleave"),t.displayUser=!1,rd.nav((function(){m.redraw()})))})))}},children:[{tag:"div",attrs:{className:"corner-right"},children:[{tag:"div",attrs:{className:"tr"}}]},{tag:"div",attrs:{className:"ui  attracted segment notify-content sha3"},children:[{tag:"a",attrs:{href:"/@/"+i.userId,class:"fluid ui small button",config:m.route,onclick:function(){t.displayUser=!1,rd.nav((function(){m.redraw()}))}},children:[{tag:"i",attrs:{class:"user icon"}},"Profile"]},{tag:"br",attrs:{}},{tag:"a",attrs:{href:"/logout",class:"fluid ui small button"},children:[{tag:"i",attrs:{class:"sign out icon"}},"Logout"]}]}]}:""]}]});e.exports=n},{"../../ws/_wsCtrl.js":16,".././api.msx":1}],11:[function(t,e,a){var i=t("../ws/_wsCtrl.js"),n=t("./api.msx"),s=t("./menu_button/User.msx"),r=t("./menu_button/Login.msx"),o=t("./menu_button/Message.msx"),d=t("./menu_button/Friend.msx"),c={controller:function(){m.redraw.strategy("diff"),n.rd("Controller: nav");var t=this;t.ping=m.prop(i.ping),t.userNumber=m.prop(0);var e=setInterval((function(){i.ping&&(clearInterval(e),rd.nav((function(){t.ping(i.ping),t.userNumber(i.total),m.redraw()})))}),200);setInterval((function(){rd.nav((function(){t.ping(i.ping),t.userNumber(i.total),m.redraw()}))}),1e3),t.displayUser=!1,t.toggleUser=function(){i.data.notify.display=!1,i.data.makeFriend.display=!1,t.displayUser=!t.displayUser},t.displayLogin=!1,t.toggleLogin=function(){t.displayLogin=!t.displayLogin},t.displayNofity=function(){0==i.data.notify.display&&(i.data.notify.init=!1,i.send(i.sendData("gnm",0))),i.data.notify.n=0,i.data.makeFriend.display=!1,t.displayUser=!1,i.data.notify.display=!i.data.notify.display},t.displayFriend=function(){0==i.data.makeFriend.display&&(i.data.makeFriend.init=!1,i.send(i.sendData("gmf",0))),i.data.notify.display=!1,t.displayUser=!1,i.data.makeFriend.display=!i.data.makeFriend.display}},view:function(t){return n.rd("nav: "+redraw.nav),redraw.nav++,{tag:"div",attrs:{className:"ui top small blue inverted fixed  menu sha"},children:[{tag:"div",attrs:{className:"ui top small blue inverted fixed  menu sha",style:"width: 1000px;left: 0; right: 0; margin: 0 auto;"},children:[{tag:"a",attrs:{href:"/","data-content":"Home","data-position":"bottom left",className:("/"==m.route()?"active":"")+" item route-button route fix-icon",config:function(t,e){e||$(t).popup({inline:!0})}},children:[{tag:"i",attrs:{className:"large icon home users-icon"}}]},{tag:"a",attrs:{href:"/qa","data-content":"Question & Answer","data-position":"bottom left",className:("/qa"==m.route()?"active":"")+" item route-button route fix-icon",config:function(t,e){e||$(t).popup({inline:!0})}},children:[{tag:"i",attrs:{className:"large browser icon"}}]},{tag:"a",attrs:{href:"/chatroom","data-content":"Chat Room","data-position":"bottom left",className:("/chatroom"==m.route().substring(0,9)?"active":"")+" item route-button route fix-icon",config:function(t,e){e||$(t).popup({inline:!0})}},children:[{tag:"i",attrs:{className:"large icon comments"}}]},i.userId.length>0?{tag:"div",attrs:{className:"right menu "},children:[{tag:"div",attrs:{className:"item fix-icon","data-content":"Users Online","data-position":"bottom right",config:function(t,e){e||$(t).popup({inline:!0})}},children:[{tag:"i",attrs:{className:"large icon  users"}},{tag:"div",attrs:{className:"bold"},children:[t.userNumber()?t.userNumber():"?"]}]},{tag:"a",attrs:{href:"javascript:void(0)",className:"item fix-icon",config:function(t,e,a){e||$(t).popup({popup:$(".ui.popup.show-ping"),position:"bottom right",on:"hover"})}},children:[t.ping()>8e3||t.ping()<0?{tag:"i",attrs:{className:"large spinner loading "+(t.ping()>6e3?"red":"")+" icon zero-margin-right"}}:{tag:"i",attrs:{className:"large "+(t.ping()<1500?"":t.ping()<3e3?"yellow":"red")+" icon heartbeat zero-margin-right",config:function(e,a,i){a||setTimeout((function a(){$(e).transition("jiggle"),t.ping()>0||t.ping<=500?setTimeout(a,1e3):setTimeout(a,500)}),1e3)}}}]},d(t),o(t),s(t)]}:{tag:"div",attrs:{className:"right menu"},children:[{tag:"div",attrs:{className:"item fix-icon"},children:[{tag:"i",attrs:{className:"large icon users"}},{tag:"div",attrs:{className:"bold"},children:[t.userNumber()?t.userNumber():"?"]}]},{tag:"a",attrs:{href:"javascript:void(0)",className:"item fix-icon",config:function(t,e,a){e||$(t).popup({popup:$(".ui.popup.show-ping"),position:"bottom right",on:"hover"})}},children:[t.ping()>8e3||t.ping()<0?{tag:"i",attrs:{className:"large spinner loading "+(t.ping()>6e3?"red":"")+" icon zero-margin-right"}}:{tag:"i",attrs:{className:"large "+(t.ping()<1500?"":t.ping()<3e3?"yellow":"red")+" icon heartbeat zero-margin-right",config:function(e,a,i){a||setTimeout((function a(){$(e).transition("jiggle"),t.ping()>0||t.ping<=500?setTimeout(a,1e3):setTimeout(a,500)}),1e3)}}}]},r(t)]},l(t),u(t),h(t),{tag:"div",attrs:{className:"ui modal sign-up"},children:[{tag:"div",attrs:{className:"ui segment loading",style:"min-height: 500px;"}}]},{tag:"div",attrs:{className:"ui modal sign-in"},children:[{tag:"div",attrs:{className:"ui segment loading",style:"min-height: 300px;"}}]}]}]}}},l=function(t){return{tag:"div",attrs:{className:"ui  popup show-ping"},children:[{tag:"div",attrs:{className:t.ping()<500?"green":t.ping()<1500?"yellow":"red"},children:[t.ping()," ms"]}]}},u=function(t){return{tag:"div",attrs:{className:"ui popup show-makeFriend"},children:[{tag:"div",attrs:{},children:["Friend requests"]}]}},h=function(t){return{tag:"div",attrs:{className:"ui  popup show-messages"},children:[{tag:"div",attrs:{},children:["Messages"]}]}};e.exports=c},{"../ws/_wsCtrl.js":16,"./api.msx":1,"./menu_button/Friend.msx":7,"./menu_button/Login.msx":8,"./menu_button/Message.msx":9,"./menu_button/User.msx":10}],12:[function(t,e,a){var i=t("../ws/_wsCtrl.js"),n=t("./api.msx"),s={},r={controller:function(){console.log("controller dashboard!"),$.cookie("url",m.route(),{path:"/"});var t=this;t.server=s.dashboard||{server:!1},void 0===m.route.param("questionId")&&i.send(i.sendData("initQA",{})),t.setup=function(){i.question().answer=i.question().answer.reverse()},t.setupHotQuestion=function(){i.initHotQuestion=!0},i.request2=n.requestWithFeedback2({method:"GET",url:"/qa/hotquestion"},i.hotQuestion,t.setupHotQuestion),t.inputAnswer=m.prop(""),t.sendAnswer=function(){i.send(i.sendData("answer",{questionId:m.route.param("questionId"),answer:t.inputAnswer()})),t.inputAnswer("")},t.input={},t.getInput=function(e){return void 0===t.input[e]&&(t.input[e]=m.prop("")),t.input[e]},t.addComment=function(t,e,a){i.send(i.sendData("commentQA",{id:t,parentType:a,comment:e(),questionId:m.route.param("questionId")}))},void 0!==m.route.param("questionId")&&(i.requestQa=n.requestWithFeedback2({method:"GET",url:"/viewquestion/"+m.route.param("questionId")},i.question,t.setup),i.send(i.sendData("subQuestion",{id:m.route.param("questionId")}))),t.server.server=!1,rd.qa((function(){m.redraw()}))},view:function(t){return{tag:"div",attrs:{id:"qa",className:"ui grid main-content"},children:[{tag:"div",attrs:{className:"eleven wide column mh500"},children:[void 0!==m.route.param("questionId")?i.requestQa.ready()?r.viewQuestion(t,i.question().question,i.question().answer):{tag:"div",attrs:{className:"ui loading segment mh500"}}:i.data.qa.init?r.list(t,i.data.qa.list):{tag:"div",attrs:{className:"ui loading segment mh500"}}]},{tag:"div",attrs:{className:"five wide column mh500"},children:[{tag:"div",attrs:{className:"ui  home-post-Wr mh500"},children:[{tag:"div",attrs:{className:"trending"},children:[{tag:"h3",attrs:{},children:["Câu hỏi HOT"]},i.initHotQuestion?{tag:"ul",attrs:{},children:[i.hotQuestion().map((function(t){return{tag:"li",attrs:{},children:[{tag:"a",attrs:{className:"route",href:"/qa/"+t.id},children:[t.question]}]}}))]}:"loading !!"]}]}]}]}}};r.list=function(t,e){return{tag:"div",attrs:{className:"list-question"},children:[{tag:"div",attrs:{className:"ui top attached tabular menu"},children:[{tag:"a",attrs:{className:("/qa"===m.route()?"active":"")+" item route",href:"/qa"},children:["New Questions"]},{tag:"a",attrs:{className:("/qa/new"===m.route()?"active":"")+" item route",href:"/qa/new"},children:["Add a new question"]}]},{tag:"div",attrs:{className:"ui bottom attached segment "},children:["/qa/new"!==m.route()?{tag:"div",attrs:{className:"ui large relaxed divided list"},children:[e.map((function(t){return r.question(t)}))]}:{tag:"form",attrs:{className:"ui form",method:"post",action:"/qa/new",config:function(t,e){e||$(t).on("submit",(function(e){e.preventDefault();var a=$(this).serializeObject();$(t).addClass("loading"),$.ajax({type:"POST",url:$(this).attr("action"),data:JSON.stringify(a),contentType:"application/json"}).done((function(e,a,i){t.reset(),$(t).removeClass("loading"),m.route("/qa/")})).fail((function(t,e,a){console.log("Ajax problem: "+e+". "+a)}))}))}},children:[{tag:"div",attrs:{className:"field"},children:[{tag:"label",attrs:{},children:["Question"]},{tag:"input",attrs:{name:"question",type:"text"}}]},{tag:"div",attrs:{className:"field"},children:[{tag:"label",attrs:{},children:["Description"]},{tag:"textarea",attrs:{name:"description",rows:"2",style:"margin-top: 0px; margin-bottom: 0px; height: 58px;"}}]},{tag:"button",attrs:{type:"submit",className:"ui primary button"},children:["Ask"]}]}]}]}},r.question=function(t){return{tag:"div",attrs:{className:"item"},children:[{tag:"div",attrs:{className:"mini ui statistics"},children:[{tag:"div",attrs:{className:" red statistic"},children:[{tag:"div",attrs:{className:"value"},children:[t.voteCount]},{tag:"div",attrs:{className:"label"},children:["votes"]}]},{tag:"div",attrs:{className:"orange statistic"},children:[{tag:"div",attrs:{className:"value"},children:[t.answerCount]},{tag:"div",attrs:{className:"label"},children:["Answers"]}]},{tag:"div",attrs:{className:"yellow statistic"},children:[{tag:"div",attrs:{className:"value"},children:[t.views]},{tag:"div",attrs:{className:"label"},children:["Views"]}]}]},{tag:"div",attrs:{className:"content"},children:[{tag:"a",attrs:{className:"header route",href:"/qa/"+t.id},children:[t.question]},{tag:"question",attrs:{className:"description"}}]}]}},r.viewQuestion=function(t,e,a){return{tag:"div",attrs:{className:"ui"},children:[{tag:"div",attrs:{className:"content"},children:[{tag:"div",attrs:{className:"ui grid qaWr"},children:[{tag:"div",attrs:{className:"one wide column voteWr"},children:[{tag:"div",attrs:{className:"ui relaxed list"},children:[{tag:"a",attrs:{className:"item",onclick:function(t){t.preventDefault();var a;void 0===e.votes?a="up":e.votes[0].vote===-1&&(a="reup"),(void 0===e.votes||void 0!==e.votes&&e.votes[0].vote===-1)&&$.ajax({type:"POST",url:"/vote/question/"+e.id,data:JSON.stringify({vote:a}),contentType:"application/json",dataType:"text",success:function(t){"voted"===t&&(i.question().question.votes=[{userId:i.userId,vote:1}],"up"===a&&(e.voteCount+=1),"reup"===a&&(e.voteCount+=2),rd.qa((function(){m.redraw()})))}})}},children:[{tag:"i",attrs:{className:(void 0!==e.votes&&1===e.votes[0].vote?"blue":"")+" big caret up icon"}}]},{tag:"div",attrs:{className:"item"},children:[{tag:"span",attrs:{className:"numVote"},children:[e.voteCount]}]},{tag:"a",attrs:{className:"item",onclick:function(t){t.preventDefault();var a;void 0===e.votes?a="down":1===e.votes[0].vote&&(a="redown"),(void 0===e.votes||void 0!==e.votes&&1===e.votes[0].vote)&&$.ajax({type:"POST",url:"/vote/question/"+e.id,data:JSON.stringify({vote:a}),contentType:"application/json",dataType:"text",success:function(t){"voted"===t&&(i.question().question.votes=[{userId:i.userId,vote:-1}],"down"===a&&(e.voteCount-=1),"redown"===a&&(e.voteCount-=2),rd.qa((function(){m.redraw()})))}})}},children:[{tag:"i",attrs:{className:(void 0!==e.votes&&e.votes[0].vote===-1?"blue":"")+" big caret down icon"}}]}]}]},{tag:"div",attrs:{className:"fifteen wide column"},children:[{tag:"div",attrs:{className:"ui middle aligned divided list qa"},children:[{tag:"div",attrs:{className:"item question"},children:[{tag:"div",attrs:{className:"ui large header"},children:[m.trust(n.post(e.question))]},{tag:"div",attrs:{className:"content"},children:[e.description]},{tag:"div",attrs:{class:"content clearfix"},children:[{tag:"a",attrs:{class:"right floated author route ulpt",href:"/@/"+e.user.id},children:[{tag:"img",attrs:{class:"ui avatar image",src:e.user.avatar.length>0?"/getimage/small/"+e.user.avatar:i.defaultAvata}}," ",e.user.name]}]}]},e.comment.map((function(t){return{tag:"div",attrs:{className:"item comment"},children:[{tag:"div",attrs:{className:"content"},children:[t.comment," - ",{tag:"a",attrs:{class:"route ulpt",href:"/@/"+t.user.id},children:[t.user.name]}]}]}})),{tag:"div",attrs:{className:"item"},children:[r.comment(t,t.addComment,e.id,t.getInput(e.id),"q")]}]}]},{tag:"h2",attrs:{className:""},children:["Answers"]}]},a.map((function(a){return{tag:"div",attrs:{className:"ui grid qaWr"},children:[{tag:"div",attrs:{className:"one wide column voteWr"},children:[{tag:"div",attrs:{className:"ui relaxed list"},children:[{tag:"a",attrs:{className:"item",onclick:function(t){t.preventDefault();var e;void 0===a.votes?e="up":a.votes[0].vote===-1&&(e="reup"),(void 0===a.votes||void 0!==a.votes&&a.votes[0].vote===-1)&&$.ajax({type:"POST",url:"/vote/answer/"+a.id,data:JSON.stringify({vote:e}),contentType:"application/json",dataType:"text",success:function(t){"voted"===t&&(a.votes=[{userId:i.userId,vote:1}],"up"===e&&(a.voteCount+=1),"reup"===e&&(a.voteCount+=2),rd.qa((function(){m.redraw()})))}})}},children:[{tag:"i",attrs:{className:(void 0!==a.votes&&1===a.votes[0].vote?"blue":"")+" big caret up icon"}}]},{tag:"div",attrs:{className:"item"},children:[{tag:"span",attrs:{className:"numVote"},children:[a.voteCount]}]},{tag:"a",attrs:{className:"item",onclick:function(t){t.preventDefault();var e;void 0===a.votes?e="down":1===a.votes[0].vote&&(e="redown"),(void 0===a.votes||void 0!==a.votes&&1===a.votes[0].vote)&&$.ajax({type:"POST",url:"/vote/answer/"+a.id,data:JSON.stringify({vote:e}),contentType:"application/json",dataType:"text",success:function(t){"voted"===t&&(a.votes=[{userId:i.userId,vote:-1}],"down"===e&&(a.voteCount-=1),"redown"===e&&(a.voteCount-=2),rd.qa((function(){m.redraw()})))}})}},children:[{tag:"i",attrs:{className:(void 0!==a.votes&&a.votes[0].vote===-1?"blue":"")+" big caret down icon"}}]}]}]},{tag:"div",attrs:{className:"fifteen wide column"},children:[{tag:"div",attrs:{className:"ui middle aligned divided list qa"},children:[{tag:"div",attrs:{className:"item answer"},children:[{tag:"div",attrs:{className:"content"},children:[m.trust(n.post(a.answer))]},{tag:"div",attrs:{class:"content clearfix"},children:[{tag:"a",attrs:{class:"right floated author route ulpt",href:"/@/"+e.user.id},children:[{tag:"img",attrs:{class:"ui avatar image",src:e.user.avatar.length>0?"/getimage/small/"+e.user.avatar:i.defaultAvata}}," ",e.user.name]}]}]},a.comment.map((function(t){return{tag:"div",attrs:{className:"item comment"},children:[{tag:"div",attrs:{className:"content"},children:[t.comment," - ",{tag:"a",attrs:{class:"route ulpt",href:"/@/"+t.user.id},children:[t.user.name]}]}]}})),{tag:"div",attrs:{className:"item"},children:[r.comment(t,t.addComment,a.id,t.getInput(a.id),"a")]}]}]}]}})),{tag:"div",attrs:{className:"ui form answerWr"},children:[{tag:"div",attrs:{className:"field"},children:[{tag:"label",attrs:{},children:["Text"]},{tag:"input",attrs:{name:"questionId",type:"hidden",value:e.id}},{tag:"textarea",attrs:{name:"answer",style:"max-height: 68px",config:function(e,a,s){a||(0==i.userId.length?$(e).on("click input",(function(){n.signin(),e.value=""})):$(e).on("input",(function(){t.inputAnswer($(e).val())})),$(e).textareaAutoSize()),e.value=t.inputAnswer(),e.value.length<1&&$(e).css("height","24")},onkeypress:function(e){if(13==e.keyCode&&!e.shiftKey&&(m.redraw.strategy("none"),13==e.keyCode&&e.shiftKey&&t.inputAnswer().length<1))return!1}}}]},{tag:"div",attrs:{className:"field"},children:[{tag:"button",attrs:{type:"submit",onclick:function(){t.sendAnswer()}},children:["Answer"]}]}]}]}]}},r.comment=function(t,e,a,s,r){return{tag:"textarea",attrs:{rows:"1",style:"max-height: 74px; padding: 5px;",className:"commentQA",config:function(t,e,a){e||(0==i.userId.length?$(t).on("click input",(function(){n.signin(),t.value=""})):$(t).on("input",(function(){s($(t).val())})),$(t).textareaAutoSize()),t.value=s(),t.value.length<1&&$(t).css("height","26")},onkeypress:function(t){return 13!=t.keyCode||t.shiftKey?(m.redraw.strategy("none"),!(13==t.keyCode&&t.shiftKey&&s().length<1)&&void 0):(m.redraw.strategy("none"),s().length<1?(console.log("chat length < 1"),!1):(e(a,s,r),s(""),!1))},placeholder:"Click here to type a comment"}}},e.exports=r},{"../ws/_wsCtrl.js":16,"./api.msx":1}],13:[function(t,e,a){var i=t("../ws/_wsCtrl.js"),n=t("./api.msx"),s={controller:function(){m.redraw.strategy("diff"),$.cookie("url",m.route(),{path:"/"});var t=this;t.id=m.route.param("roomId"),t.param=m.prop(m.route.param("roomId")),t.loadMore=!0,t.scrollBottom=!0,t.add=function(){var e=i.inputChat(t.id)().trim();e&&(i.send(i.sendData("chat",{room:t.id,d:e})),i.inputChat(t.id)("")),rd.room((function(){m.redraw()}))},t.setupHotQuestion=function(){i.initHotQuestion=!0},i.request2=n.requestWithFeedback2({method:"GET",url:"/qa/hotquestion"},i.hotQuestion,t.setupHotQuestion),i.send(i.sendData("initChat",{t:"room",v:t.param()}));var e=setInterval((function(){i.send(i.sendData("sub",{t:"room",v:t.param()}))}),3e4);t.onunload=function(){i.send(i.sendData("unSub",{t:"room",v:t.param()})),i.clearOldRoom(t.id),clearInterval(e)},console.log("ctrl room !"),rd.room()},view:function(t){return{tag:"div",attrs:{className:"ui grid main-content "},children:[{tag:"div",attrs:{className:"eleven wide column room-chat"},children:[{tag:"div",attrs:{className:"ui segment segWr"},children:[{tag:"div",attrs:{className:"ui padded grid"},children:[{tag:"div",attrs:{className:"thirteen wide  column light-border-right pad-bot0"},children:[r(t)]},{tag:"div",attrs:{className:"three wide column"},children:[{tag:"div",attrs:{className:"room-user"},children:[{tag:"h5",attrs:{className:"ui dividing header"},children:["List Users !"]},{tag:"div",attrs:{},children:[{tag:"div",attrs:{},children:[i.getRoom(t.id).initOk?{tag:"div",attrs:{className:"ui list users-in-room"},children:[i.userInRoom(t.id).map((function(t){return{tag:"div",attrs:{className:"item"},children:[{tag:"i",attrs:{className:"user "+("Admin"==t.role?"red":"Mod"==t.role?"yellow":"blue")+" icon"}},{tag:"div",attrs:{className:"content"},children:[{tag:"a",attrs:{className:"ulpt",href:"/@/"+t.id,config:m.route},children:[t.name]}]}]}}))]}:{tag:"div",attrs:{className:"ui active loader"}}]}]}]}]}]},{tag:"div",attrs:{className:"ui padded grid "},children:[{tag:"div",attrs:{className:"thirteen wide column light-border-right pad-top0"},children:[{tag:"div",attrs:{className:"ui divider"}},{tag:"div",attrs:{className:"ui comments mar0"},children:[{tag:"div",attrs:{className:"comment"},children:[{tag:"a",attrs:{className:"avatar"},children:[{tag:"img",attrs:{src:i.avatar.length>0?i.static+"/getimage/thumb/"+i.avatar:"/assets/avatar/2.jpg"}}]},{tag:"div",attrs:{className:"ui form content"},children:[{tag:"div",attrs:{className:"field",style:"display:inline"},children:[{tag:"textarea",attrs:{rows:"1",style:"max-height: 150px",config:function(e,a,s){a||(0==i.userId.length?$(e).on("click input",(function(){n.signin(),e.value=""})):$(e).on("input",(function(){i.inputChat(t.id)($(e).val())})),$(e).textareaAutoSize(),$(e).attrchange({callback:function(t){var a=document.getElementsByClassName("box-comment")[0],i=$(".box-comment");$(e);i.scrollTop()+i.innerHeight()>=i.prop("scrollHeight")?(i.css("height",526-$(e).outerHeight()),a.scrollTop=a.scrollHeight):i.css("height",526-$(e).outerHeight())}})),e.value=i.inputChat(t.id)(),e.value.length<1&&$(e).css("height","36.4286px")},onkeypress:function(e){if(13==e.keyCode&&!e.shiftKey){if(m.redraw.strategy("none"),i.inputChat(t.id)().length<1)return console.log("chat length < 1"),!1;e.target||e.srcElement;return t.add(),!1}if(m.redraw.strategy("none"),13==e.keyCode&&e.shiftKey&&i.inputChat(t.id)().length<1)return!1},placeholder:"Click here to type a chat message"}}]}]}]}]}]},{tag:"div",attrs:{className:"three wide column pad-top0"},children:[{tag:"div",attrs:{className:"ui divider "}},{tag:"div",attrs:{}}]}]}]}]},{tag:"div",attrs:{className:"five wide column"},children:[{tag:"div",attrs:{className:"ui mh500"},children:[{tag:"div",attrs:{className:"trending"},children:[{tag:"h3",attrs:{},children:["Câu hỏi HOT"]},i.initHotQuestion?{tag:"ul",attrs:{},children:[i.hotQuestion().map((function(t){return{tag:"li",attrs:{},children:[{tag:"a",attrs:{className:"route",href:"/qa/"+t.id},children:[t.question]}]}}))]}:"loading !!"]}]}]}]}}},r=function(t){return{tag:"div",attrs:{className:"ui comments room-box"},children:[{tag:"h5",attrs:{className:"ui dividing header"},children:["Room: ",t.id,{tag:"span",attrs:{className:"fr"},children:[{tag:"i",attrs:{className:"tiny users left middle aligned icon",style:"margin: 0 5px;"},children:[i.getRooms(t.id).u]},{tag:"i",attrs:{className:"tiny plug left middle aligned icon",style:"margin: 0 5px;"},children:[i.getRooms(t.id).c]}]}]},{tag:"div",attrs:{className:"box-commentWr"},children:[{tag:"div",attrs:{className:"box-comment",config:function(e,a,n){1==n.flagScroll&&(n.fixPos=n.prevScrollTop+e.scrollHeight-n.prevScrollHeight),1==i.getRoom(t.id).gettingPrev&&(e.scrollTop=n.prevScrollTop+e.scrollHeight-n.prevScrollHeight,downkey?(n.flagScroll=!1,$(e).on("scroll",(function a(){e.scrollTop=n.fixPos,$(document).on("mouseup",(function s(){$(document).off("mouseup",s),$(e).off("scroll",a),n.flagScroll=!0,i.getRoom(t.id).gettingPrev=!1}))}))):i.getRoom(t.id).gettingPrev=!1),void 0==n.flagScroll&&(n.flagScroll=!0),n.run&&i.getRoom(t.id).initOk&&(e.scrollTop=e.scrollHeight,n.run=!1),a||(n.run=!0,$(e).on("scroll",(function(){e.scrollHeight-e.scrollTop-e.clientHeight>50?t.scrollBottom=!1:t.scrollBottom=!0,i.getRoom(t.id).initOk&&e.scrollTop<10&&0==i.getRoom(t.id).gettingPrev&&i.loadMoreComments(t.id)&&(t.loadMore=!1,i.getRoom(t.id).gettingPrev=!0,i.send(i.sendData("prevChat",{t:"room",v:t.param(),lastTime:i.commentsInRoom(t.id)[0].time}))),n.prevScrollTop=e.scrollTop})));e.scrollHeight-n.prevScrollHeight||0;t.scrollBottom&&(e.scrollTop=e.scrollHeight),n.prevScrollTop=e.scrollTop,n.prevScrollHeight=e.scrollHeight}},children:[i.getRoom(t.id).initOk?{tag:"div",attrs:{},children:[i.commentsInRoom(t.id).map((function(t){return{tag:"div",attrs:{className:"comment",key:t.time},children:[{tag:"a",attrs:{className:"avatar ulpt",href:"/@/"+t.userId,config:m.route},children:[{tag:"img",attrs:{src:t.avatar}}]},{tag:"div",attrs:{className:"content"},children:[{tag:"a",attrs:{className:"author ulpt",href:"/@/"+t.userId,config:m.route},children:[t.user]},{tag:"div",attrs:{className:" metadata fr"},children:[{tag:"span",attrs:{className:"date"},children:[n.time(t.time)]}]},{tag:"div",attrs:{className:"text"},children:[m.trust(n.post(t.comment))]}]}]}}))]}:{tag:"div",attrs:{className:"ui active loader"}}]}]}]}};e.exports=s},{"../ws/_wsCtrl.js":16,"./api.msx":1}],14:[function(t,e,a){var i=t("../ws/_wsCtrl.js"),n=t("./api.msx"),s={controller:function(){var t=this;t.userId=m.route.param("user"),t.user=m.prop({}),t.initFollower=!1,t.initFriend=!1,t.followers=m.prop([]),t.friends=m.prop([]),t.setup=function(){rd.user()},t.setupFollower=function(){t.initFollower=!0},t.setupFriend=function(){t.initFriend=!0},i.request1=n.requestWithFeedback2({method:"GET",url:"/api/listfollow/"+t.userId},t.followers,t.setupFollower),i.request2=n.requestWithFeedback2({method:"GET",url:"/api/listfriend/"+t.userId},t.friends,t.setupFriend),t.error=function(){m.route("/")},t.request=n.requestWithFeedback2({method:"GET",url:"/api/getUser/"+t.userId},t.user,t.setup,t.error),rd.user()},view:function(t){return t.request.ready()?[{tag:"div",attrs:{className:"ui grid main-content sha2"},children:[{tag:"div",attrs:{className:"head-user ui grid"},children:[{tag:"div",attrs:{className:"four wide column",style:"  min-height: 250px"},children:[{tag:"div",attrs:{className:"avatarWr"},children:[{tag:"img",attrs:{id:"avatarImg",src:t.user().avatar.length>0?i.static+"/getimage/small/"+t.user().avatar:"/assets/img/user.jpg",width:"180",height:"180"}}]}]},{tag:"div",attrs:{className:"twelve wide column",style:"min-height: 250px"},children:[{tag:"h2",attrs:{className:"ui header"},children:[t.user().name]},{tag:"div",attrs:{className:"edit"},children:[i.userId!==t.userId?[]:{tag:"a",attrs:{className:"ui basic button",href:"/settings",config:m.route},children:[{tag:"i",attrs:{className:"write square icon"}},"Edit Profile"]}]},{tag:"div",attrs:{className:"ui divider"}},{tag:"br",attrs:{}},{tag:"br",attrs:{}},{tag:"br",attrs:{}},{tag:"br",attrs:{}},{tag:"br",attrs:{}},{tag:"div",attrs:{className:"ui divider"}},{tag:"div",attrs:{className:"infoWr"},children:[{tag:"div",attrs:{className:"relation_actions"},children:[i.userId===t.user().username?[{tag:"a",attrs:{className:"tiny ui  basic  relation button hint--bottom hover_text custom",tabindex:"0",href:"#"},children:[{tag:"span",attrs:{className:"content"},children:[t.user().extra.nbFollower," Folowers"]}]},{tag:"a",attrs:{className:"tiny ui  basic  relation button hint--bottom hover_text custom",tabindex:"0",href:"#"},children:[{tag:"span",attrs:{className:"content"},children:[t.user().extra.nbFriends," Friends"]}]}]:[t.user().extra.relation?{tag:"a",attrs:{className:"tiny ui blue basic animated relation button hint--bottom hover_text custom",tabindex:"0",href:"/rel/unfollow/"+t.user().username+"?mini=1"},children:[{tag:"span",attrs:{className:"visible content"},children:[t.user().extra.nbFollower," Follower"]},{tag:"span",attrs:{className:"hidden content"},children:[{tag:"i",attrs:{className:"thumbs up icon"}},"Following"]}]}:{tag:"a",attrs:{className:"tiny ui  basic animated relation button hint--bottom hover_text custom",tabindex:"0",href:"/rel/follow/"+t.user().username+"?mini=1"},children:[{tag:"span",attrs:{className:"visible content"},children:[t.user().extra.nbFollower," Follower"]},{tag:"span",attrs:{className:"hidden content"},children:[{tag:"i",attrs:{className:"thumbs outline up icon"}},"Follow"]}]},t.user().extra.friend?{tag:"a",attrs:{className:"tiny ui blue basic animated relation button hint--bottom hover_text custom unfriend",tabindex:"0",href:"/rel/unfriend/"+t.user().username+"?mini=1"},children:[{tag:"span",attrs:{className:"visible content unfriend"},children:[t.user().extra.nbFriends," Friends"]},{tag:"span",attrs:{className:"hidden content unfriend"},children:[{tag:"i",attrs:{className:"remove user icon"}},"Unfriend"]}]}:t.user().extra.makeFriend?{tag:"a",attrs:{className:"tiny ui olive basic animated relation button hint--bottom hover_text custom",tabindex:"0",href:"/rel/unrequest/"+t.user().username+"?mini=1"},children:[{tag:"span",attrs:{className:"visible content"},children:[t.user().extra.nbFriends," Friends"]},{tag:"span",attrs:{className:"hidden content"},children:[{tag:"i",attrs:{className:"thumbs up icon"}},"Cancel Request"]}]}:{tag:"a",attrs:{className:"tiny ui  basic animated relation button hint--bottom hover_text custom",
tabindex:"0",href:"/rel/request/"+t.user().username+"?mini=1"},children:[{tag:"span",attrs:{className:"visible content"},children:[t.user().extra.nbFriends," Friends"]},{tag:"span",attrs:{className:"hidden content"},children:[{tag:"i",attrs:{className:"thumbs up icon"}},"Add Friend"]}]}]]}]}]}]}]},{tag:"div",attrs:{className:"ui grid main-content sha2"},children:[{tag:"div",attrs:{className:"body-user ui grid"},children:[{tag:"div",attrs:{className:"eight wide column",style:"min-height: 200px; border-right: 1px solid #ddd"},children:[{tag:"h3",attrs:{},children:["List Followers"]},t.initFollower?{tag:"ul",attrs:{},children:[t.followers().map((function(t){return{tag:"li",attrs:{},children:[{tag:"a",attrs:{className:"route ulpt",href:"/@/"+t},children:[t]}]}}))]}:"loading ..."]},{tag:"div",attrs:{className:"eight wide column",style:"min-height: 200px"},children:[{tag:"h3",attrs:{},children:["List Friends"]},t.initFriend?{tag:"ul",attrs:{},children:[t.friends().map((function(t){return{tag:"li",attrs:{},children:[{tag:"a",attrs:{className:"route ulpt",href:"/@/"+t},children:[t]}]}}))]}:"loading ..."]}]}]}]:{tag:"div",attrs:{className:"ui segment loading mh500"}}}};e.exports=s},{"../ws/_wsCtrl.js":16,"./api.msx":1}],15:[function(t,e,a){var i=t("../ws/_wsCtrl.js"),n=t("./api.msx"),s={controller:function(){var t=this;i.userId.length<1?m.route("/"):(t.user=m.prop({}),t.setup=function(){rd.setting()},t.request=n.requestWithFeedback2({method:"POST",url:"/settings"},t.user,t.setup),rd.setting())},view:function(t){return t.request.ready()?[{tag:"div",attrs:{className:"ui grid main-content sha2 "},children:[{tag:"div",attrs:{className:"head-user ui grid"},children:[{tag:"div",attrs:{className:"four wide column",style:"  min-height: 250px"},children:[r(t)]},{tag:"div",attrs:{className:"twelve wide column edit-information",style:"b min-height: 250px"},children:[{tag:"div",attrs:{class:"ui labeled input"},children:[{tag:"div",attrs:{className:"field"},children:["Name:"]},{tag:"input",attrs:{id:"name",type:"text",placeholder:"Tên hiển thị!",value:t.user().name}}]},{tag:"br",attrs:{}},{tag:"br",attrs:{}},{tag:"br",attrs:{}},{tag:"br",attrs:{}},{tag:"br",attrs:{}},{tag:"br",attrs:{}},{tag:"br",attrs:{}},{tag:"div",attrs:{className:"ui divider"}},{tag:"button",attrs:{class:"ui button",onclick:function(){var t={name:$("#name").val()};console.log(t),$.ajax({type:"POST",url:"/settings/updateInfo",data:JSON.stringify(t),contentType:"application/json",dataType:"text",success:function(t){i.userName=$("#name").val()}})}},children:["Save"]},{tag:"button",attrs:{class:"ui button"},children:["Reset"]}]}]}]}]:{tag:"div",attrs:{className:"ui segment main-content loading mh500"}}}},r=function(t){return{tag:"div",attrs:{className:"ui segment avatarWr"},children:[{tag:"div",attrs:{className:"ui special  cards",config:function(t,e,a){e||$(".special.cards .image").dimmer({on:"hover"})}},children:[{tag:"div",attrs:{className:"card"},children:[{tag:"div",attrs:{className:"blurring dimmable image"},children:[{tag:"div",attrs:{className:"ui dimmer"},children:[{tag:"div",attrs:{className:"content"},children:[{tag:"div",attrs:{className:"center"},children:[{tag:"form",attrs:{id:"formUpload",enctype:"multipart/form-data",action:"/upload/image",method:"post"},children:[{tag:"input",attrs:{className:"avatar-upload",name:"picture",id:"picture",type:"file",accept:"image/*",config:function(t,e){e||$(t).change((function(){var t,e,a=window.URL||window.webkitURL;(t=this.files[0])&&(e=new Image,e.onload=function(){this.width>=180&&this.height>=180?($(".avatarWr").addClass("loading"),jQuery.each(jQuery("#picture")[0].files,(function(t,e){n.append("file-"+t,e)})),jQuery.ajax({url:"/upload/image",data:n,cache:!1,contentType:!1,processData:!1,type:"POST",success:function(t){var e=i.static+"/getimage/small/"+t;$("#avatarImg").attr("src",e),$(".avatarWr").removeClass("loading"),i.avatar=t}})):alert("Chiều rộng và chiều dài của ảnh phải lớn hơn 180px")},e.src=a.createObjectURL(t));var n=new FormData}))}}}]}]}]}]},{tag:"img",attrs:{id:"avatarImg",src:t.user().avatar.length>0?i.static+"/getimage/small/"+t.user().avatar:"/assets/img/user.jpg",width:"180",height:"180"}}]}]}]}]}};e.exports=s},{"../ws/_wsCtrl.js":16,"./api.msx":1}],16:[function(t,e,a){function i(){d.storage.chat.map((function(t){f.chat.push({user:t.user,display:!0,input:m.prop(""),init:!1,hide:t.hide,read:!0,chat:[]}),b(y("init_chat",{w:t.user.id,cv:0}))}))}function n(t){var e,a;void 0===t?(e=6e3,a=2e3):(e=t,a=0),clearTimeout(g),g=setTimeout((function(){console.log("run reconnect !!"),clearTimeout(k),d.ws&&(d.ws.onerror=$.noop,d.ws.onclose=$.noop,d.ws.onopen=$.noop,d.ws.onmessage=$.noop,d.ws.close()),d.reconnect=!0,console.log("websocket will reconnect in "+a+" ms !!"),p&&clearTimeout(p),p=setTimeout(s,a)}),e)}function s(){var t=Math.random().toString(36).substring(2);"localhost"===document.domain?d.ws=new WebSocket("ws://"+document.domain+":9000/socket?sri="+t):d.ws=new WebSocket("ws://"+document.domain+":8080/socket?sri="+t),d.ws.onopen=function(){console.log("WebSocket ok"),n(),d.ping=-1,b(N()),u=Date.now(),d.data.userOnline=[],b(y("get_onlines","")),d.reconnect&&v(),i()},d.ws.onmessage=function(t){var e=JSON.parse(t.data);I.listen(e)},d.ws.onclose=function(){console.log("socket closed")},d.ws.onerror=function(){console.log("socket error")},n(4e3)}function r(){var t=Date.now();d.ping=Math.ceil(t-u)}function o(){k=setTimeout((function t(){d.ping<=6e3&&(r(),q=setTimeout(t,100))}),1500)}var d={};d.userId=document.body.getAttribute("id");var c=d.userId;d.userName=document.body.getAttribute("name");d.userName;d.avatar=document.body.getAttribute("avatar"),d.mVersion=parseInt(document.body.getAttribute("mv"));var l=d.mVersion;d.mRVersion=parseInt(document.body.getAttribute("mv"));var u,h=d.mRVersion;"localhost"===document.domain?d.static="":d.static="",d.ping=0,d.total=0,window.redraw={nav:0,home:0,dashboard:0,right:0,app:0},d.reconnect=!1,d.storage={chat:$.localStorage.get("chat:"+d.userId)||[]},d.initNewQuestion=!1,d.initHotQuestion=!1,d.newQuestion=m.prop([]),d.hotQuestion=m.prop([]),d.friendFlag=!1,d.defaultAvata="/assets/avatar/2.jpg",d.qa=m.prop({}),d.post=m.prop({}),d.question=m.prop({}),d.data={qa:{init:!1,list:[],timepoint:Date.now},post:{init:!1,list:[],timepoint:Date.now()},chatrooms:{},chatroom:{},showOnline:!0,userOnline:[],initAllFriends:!1,allFriends:[],user:{},chat:[],makeFriend:{n:0,listRequests:[],init:!1,display:!1},notify:{n:0,notifyMessage:[],init:!1,display:!1}};var g,p,f=d.data;s();var v=function(){console.log(m.route()),"/"===m.route()&&d.send(d.sendData("reconnect",{t:"home",v:d.data.post.timepoint})),m.route().toString().indexOf("/chatroom/")>=0&&(d.getRoom(I.id).initOk?d.send(d.sendData("reconnect",{t:"room",v:m.route.param("roomId")})):d.send(d.sendData("initChat",{t:"room",v:I.param()})),d.data.post.init&&d.send(d.sendData("reconnect",{t:"home",v:d.data.post.timepoint})))},N=function(){return JSON.stringify({t:"p",v:l})};d.arrayObjectIndexOf=function(t,e,a){for(var i=0,n=t.length;i<n;i++)if(t[i][a]===e)return i;return-1};var w=d.arrayObjectIndexOf;d.arrayObjectIndexOf2=function(t,e,a){for(var i=0,n=t.length;i<n;i++)if(t[i].user[a]===e)return i;return-1};d.arrayObjectIndexOf2;d.sendData=function(t,e){return JSON.stringify({t:t,d:e})};var y=d.sendData;d.send=function(t,e){x((function(){d.ws.send(t),"undefined"!=typeof e&&e()}),100)};var b=d.send,x=function(t,e){1===d.ws.readyState?t():setTimeout((function(){x(t,e)}),e)};d.getPosChat=function(t,e){var a=void 0==e?0:e;pos=-1;for(var i=0;i<f.chat.length;i++)if(f.chat[i].user.id==t.id)return pos=i,pos;if(pos=-1)return f.chat.push({user:t,display:!0,input:m.prop(""),init:!1,hide:!1,read:!0,chat:[]}),b(y("init_chat",{w:t.id,cv:a})),d.storage.chat.push({user:t,hide:!1}),$.localStorage.set("chat:"+d.userId,d.storage.chat),f.chat.length-1};var k,q,C=d.getPosChat,I={};I.listen=function(t){if("n"===t.t){clearTimeout(k),clearTimeout(q),o(),n();var e=Date.now();d.ping=Math.ceil(e-u),d.ping<=1e3?setTimeout((function(){u=Date.now(),b(N())}),1e3-d.ping):(u=Date.now(),b(N())),d.data.makeFriend.n=t.d.mf;var a=f.notify.n;f.notify.n=t.d.n,a!==f.notify.n&&rd.nav((function(){m.redraw()})),d.total=t.d.d}else if("nbRequester"===t.t)d.data.makeFriend.n=t.d;else if("initPost"===t.t)d.data.post.list=t.d,d.data.post.init=!0,d.data.post.list.length>0&&(d.data.post.timepoint=d.data.post.list[d.data.post.list.length-1].published),rd.home((function(){m.redraw()}));else if("morePost"===t.t)console.log(t.d),d.data.post.list=d.data.post.list.concat(t.d),rd.home((function(){m.redraw()}));else if("newPost"===t.t)void 0!==t.d.id&&(d.data.post.list.unshift(t.d),d.data.post.timepoint=t.d.published),rd.home((function(){m.redraw()}));else if("initQA"===t.t)d.data.qa.list=t.d,d.data.qa.init=!0,d.data.qa.list.length>0&&(d.data.qa.timepoint=d.data.qa.list[d.data.qa.list.length-1].published),rd.qa((function(){m.redraw()}));else if("mes"===t.t)if("stop"===t.d.m&&(d.ws&&(d.ws.onerror=$.noop,d.ws.onclose=$.noop,d.ws.onopen=$.noop,d.ws.onmessage=$.noop,d.ws.close()),n(0)),l>=t.d.v-1)F(t),l++,h++;else{var i={f:l+1,t:t.d.v-1};l=t.d.v,setTimeout((function e(){console.log("delay domess"),h>=i.t?(F(t),h++):setTimeout(e,200)}),1500),console.log("SEEND REQUEST GET MISSING MESS: "+i.f+"=>"+i.t),b(y("gmm",i));var s=setTimeout((function t(){h>=i.t?clearTimeout(s):(console.log("SEEND REQUEST GET MISSING MESS: "+i.f+"=>"+i.t),console.log("current mes need:"+i.t),b(y("gmm",i)),setTimeout(t,1500))}),1500)}else if("newAnswer"===t.t)d.question().answer.push(t.d),rd.qa((function(){m.redraw()}));else if("newCommentQA"===t.t){if(d.question().question.id===t.d.parentId)d.question().question.comment.push(t.d);else{var r=w(d.question().answer,t.d.parentId,"id");d.question().answer[r].comment.push(t.d)}rd.qa((function(){m.redraw()}))}else if("newComment"===t.t){if(void 0===t.d.parentId)d.post().comment.push(t.d),d.post().post.commentCount+=1;else{var r=w(d.post().comment,t.d.parentId,"id");d.post().post.commentCount+=1,d.post().comment[r].children.push(t.d),d.post().comment[r].childCount+=1}rd.home((function(){m.redraw()}))}else"moreComment"===t.t?(d.post().post.commentShow+=t.d.length,t.d.forEach((function(t){d.post().post.commentShow+=t.childCount})),d.post().comment=t.d.reverse().concat(d.post().comment),rd.home((function(){m.redraw()}))):"following_onlines"===t.t?(f.userOnline=t.d,rd.right((function(){m.redraw()}))):"friends_list"===t.t&&(f.allFriends=t.d,d.data.initAllFriends=!0,rd.right((function(){m.redraw()})));if("following_leaves"===t.t&&(f.userOnline.splice(w(f.userOnline,t.d.id,"id"),1),rd.right((function(){m.redraw()}))),"following_enters"===t.t)w(f.userOnline,t.d.id,"id")<0&&(f.userOnline.push(t.d),rd.right((function(){m.redraw()})));else if("init_chat"===t.t){var g=t.d.reverse();if(g.length>0){var p=c==t.d[0].f.id?t.d[0].t:t.d[0].f,v=C(p);f.chat[v].chat.length<=1?f.chat[v].chat=t.d.concat(f.chat[v].chat):f.chat[v].chat=t.d,rd.right((function(){m.redraw()}))}}else if("smm"===t.t)t.d.d.map((function(e){var a=c==e.f?e.t:e.f,i=C(a);f.chat[i].chat.length<1?t.d.d.map((function(t){f.chat[i].chat.push(t)})):t.d.d.map((function(t){console.log("smm: "+t.mv+" --- "+f.chat[i].chat[f.chat[i].chat.length-1].mv),t.mv>f.chat[i].chat[f.chat[i].chat.length-1].mv&&f.chat[i].chat.push(t)})),h==t.d.f-1&&(h=t.d.t)})),rd.right((function(){m.redraw()}));else if("init_notify"===t.t)f.notify.notifyMessage=t.d,f.notify.init=!0,rd.nav((function(){m.redraw()}));else if("init_friend_request"===t.t)f.makeFriend.listRequests=t.d,f.makeFriend.init=!0,rd.nav((function(){m.redraw()}));else if("chatNotify"===t.t){var x=t.d.room;if("chat"===t.d.t){var I=t.d.d;d.commentsInRoom(x).push({avatar:I.user.avatar.length>0?d.static+"/getimage/thumb/"+I.user.avatar:d.defaultAvata,userId:I.user.id,user:I.user.name,time:Date.now(),comment:I.chat})}else if("userEnter"==t.d.t){var p=t.d.u;p.role="user",w(d.userInRoom(x),p.id,"id")<0&&d.userInRoom(x).push(p)}else if("userLeaves"==t.d.t){var p=t.d.u;d.userInRoom(x).splice(w(d.userInRoom(x),p.id,"id"),1)}else if("initChat"===t.d.t){var T=t.d.lu;d.getRooms(t.d.room).c=t.d.c,d.getRooms(t.d.room).u=t.d.u;var R=t.d.lc;T.map((function(t){w(d.userInRoom(x),t.id,"id")<0&&(t.role="user",d.userInRoom(x).push(t))})),R.map((function(t){d.commentsInRoom(x).unshift({avatar:t.user.avatar.length>0?d.static+"/getimage/thumb/"+t.user.avatar:d.defaultAvata,userId:t.user.id,user:t.user.name,time:t.time,comment:t.chat})})),d.getRoom(x).initOk=!0}else if("prevChat"===t.d.t){var R=t.d.lc.reverse(),x=t.d.room;R.length<1&&(d.getRoom(x).loadMore=!1);var S=R.map((function(t){return{avatar:t.user.avatar.length>0?d.static+"/getimage/thumb/"+t.user.avatar:d.defaultAvata,userId:t.user.userId,user:t.user.name,time:t.time,comment:t.chat}}));d.data.chatroom[x].comments=S.concat(d.data.chatroom[x].comments)}else if("initChatRooms"===t.d.t){var O=t.d.v;O.map((function(t){d.getRooms(t.id).c=t.c,d.getRooms(t.id).u=t.u})),rd.chatroom((function(){m.redraw()}))}else if("io"===t.d.t){var j=t.d.v;void 0!=j.c&&(d.getRooms(j.rid).c+=parseInt(j.c)),void 0!=j.u&&(d.getRooms(j.rid).u+=parseInt(j.u)),rd.chatroom((function(){rd.room((function(){m.redraw()}))}))}rd.room((function(){m.redraw()}))}};var F=function(t){var e=c==t.d.f.id?t.d.t:t.d.f,a=C(e,t.d.mv);f.chat[a].chat.push({f:t.d.f,mv:t.d.mv,mes:t.d.m,time:t.d.time}),c!==t.d.f.id?f.chat[a].read=!1:f.chat[a].read=!0,rd.right((function(){m.redraw()}))};d.getRoom=function(t){return void 0==d.data.chatroom[t]&&(d.data.chatroom[t]={},d.data.chatroom[t].initOk=!1,d.data.chatroom[t].loadMore=!0,d.data.chatroom[t].gettingPrev=!1),d.data.chatroom[t]};d.getRoom;d.userInRoom=function(t){return void 0==d.getRoom(t).users&&(d.getRoom(t).users=[]),d.getRoom(t).users};d.userInRoom;d.loadMoreComments=function(t){return void 0==d.getRoom(t).loadMore&&(d.getRoom(t).loadMore=!0),d.getRoom(t).loadMore},d.commentsInRoom=function(t){return void 0==d.getRoom(t).comments&&(d.getRoom(t).comments=[]),d.getRoom(t).comments};d.commentsInRoom;d.inputChat=function(t){return void 0==d.getRoom(t).input&&(d.getRoom(t).input=m.prop("")),d.getRoom(t).input},d.clearOldRoom=function(t){d.data.chatroom[t]=void 0},d.getRooms=function(t){return void 0==d.data.chatrooms[t]&&(d.data.chatrooms[t]={},d.data.chatrooms[t].c=0,d.data.chatrooms[t].u=0),d.data.chatrooms[t]},$(document).on("click",".route",(function(t){console.log("route"),t.preventDefault(),m.route($(this).attr("href")),$("#powertip .mini").remove()})),$("body").on("click",".relation_actions a.relation",(function(){var t=$(this).addClass("processing");return $(this).hasClass("unfriend")&&!confirm("Are you sure you want to delete this?")||$.ajax({url:t.attr("href"),type:"post",success:function(e){t.parent().html(e)}}),!1})),e.exports=d},{}]},{},[4]);
